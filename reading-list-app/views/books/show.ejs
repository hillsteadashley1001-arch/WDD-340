<%- include('../partials/header', { title: book.title }) %>

<h1><%= book.title %></h1>

<% if (book.coverImage) { %>
  <img src="<%= book.coverImage %>" alt="Book cover" />
<% } %>

<p><strong>Authors:</strong> <%= book.authors.join(', ') %></p>

<p><%= book.description %></p>

<p><strong>Average Rating:</strong> <%= averageRating %></p>

<% if (currentUser) { %>
  <form action="/reading-list/add" method="POST">
    <input type="hidden" name="bookId" value="<%= book._id %>" />
    <button type="submit">Add to Reading List</button>
  </form>
<% } %>

<hr />

<h2>Reviews</h2>

<% reviews.forEach(review => { %>
  <div class="review">
    <p><strong><%= review.user.name %></strong></p>
    <p>Rating: <%= review.rating %>/5</p>
    <p><%= review.reviewText %></p>
  </div>
<% }) %>

<% if (currentUser) { %>
  <h3>Add Review</h3>
  <form action="/reviews/create" method="POST">
    <input type="hidden" name="bookId" value="<%= book._id %>" />
    <label>
      Rating:
      <select name="rating">
        <% for (let i = 1; i <= 5; i++) { %>
          <option value="<%= i %>"><%= i %></option>
        <% } %>
      </select>
    </label>
    <textarea name="reviewText" required></textarea>
    <button type="submit">Submit Review</button>
  </form>
<% } %>

<%- include('../partials/footer') %>
